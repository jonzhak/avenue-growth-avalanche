<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <title>Avenue Growth Users</title>
    <style>body{margin:0;padding:0;-webkit-font-smoothing:antialiased}.table-header{display:flex;align-items:center;justify-content:space-between;padding:0 15px;border-bottom:1px solid #ddd;font-family:sans-serif;font-size:16px}.btn{cursor:pointer;color:#fff;background-color:#007bff;border-color:#007bff;display:inline-block;font-weight:400;text-align:center;white-space:nowrap;vertical-align:middle;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border:1px solid transparent;padding:.25rem .5rem;font-size:.875rem;line-height:1.5;border-radius:.2rem;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}.btn:disabled{opacity:.5;pointer-events:none}.styled-table{width:100%}.styled-table{border-collapse:collapse;font-size:14px;font-family:sans-serif;min-width:400px}.styled-table thead tr{background-color:#fff;color:#212121;text-align:left;border-bottom:1px solid #ddd}.styled-table td{padding:12px 15px}.styled-table th{padding:20px 15px}.styled-table tbody tr{border-bottom:1px solid #ddd}.styled-table tbody tr:nth-of-type(even){background-color:#f3f3f3}select{display:block;width:130px;padding:5px 20px;font-size:14px;font-weight:500;line-height:1.5;color:#212529;background-color:#fff;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right .75rem center;background-size:16px 12px;border:1px solid #ced4da;border-radius:.25rem;-webkit-appearance:none;-moz-appearance:none;appearance:none}select:focus{border-color:#86b7fe;outline:0;box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}</style>     
</head>
<body>
     <div class="table-header">
          <h3>Avenue Growth Premium Users</h3>
          <button class="btn" disabled>Download as .csv</button>
     </div>
    <table class="styled-table">
          <thead>
               <tr>
                <th>Referrer Name</th>
                <th>Referrer Email</th>
                <th>Referral code</th>
                <th>Referred email</th>
                <th>Status</th>
              </tr>
          </thead>
          <tbody>       
          </tbody>
     </table>
</body>

<script type="text/javascript">
     let clientId="NiwToJ2Mlkn4ubzbymnC18vM08WSXyb5";
     $("button").on("click",function(){var n="",t=(new Date).toISOString().slice(0,10),e=[];$("table tr").each(function(n,t){var o=[];$(t).find("th, td").each(function(n,t){$(this).find(".status-select").length>0?o.push($(this).find("option:selected").text()):o.push(t.innerText)}),e.push(o.join(","))}),n+=e.join("\n"),$(document.body).append('<a id="download-link" download="export-'+t+'.csv" href='+URL.createObjectURL(new Blob([n],{type:"text/csv"}))+"/>"),$("#download-link")[0].click(),$("#download-link").remove()});var body=document.getElementsByTagName("tbody")[0];fetch("api/getToken.php",{method:"GET"}).then(e=>{if(e.ok)return e.json()}).then(e=>{let t=e.token;fetch("https://salty-reef-38656.herokuapp.com/events/all_premium_users?clientId="+clientId,{method:"GET",headers:{"Content-Type":"application/json",Authorization:t}}).then(e=>e.ok?e.json():e).then(e=>{let t="";for(var a=0;a<e.length;a++){var o;o=null!=e[a].reward_claimed?'<select name="status" class="status-select"><option value="paid" selected>Paid</option><option value="notPaid">Not paid</option></select>':'<select name="status" class="status-select"><option value="paid">Paid</option><option value="notPaid" selected>Not paid</option></select>',t+='<tr data-email="'+e[a].email+'"><td>'+e[a].name+"</td><td>"+e[a].referrer+"</td><td>"+e[a].referral_code+"</td><td>"+e[a].email+"</td><td>"+o+"</td></tr>"}body.innerHTML=t}),$("body").on("change","select",function(e){$("option:selected",this);if("paid"==this.value){let e=$(this).parent().parent().data("email");fetch("https://salty-reef-38656.herokuapp.com/events/v2/give_reward",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({email:e})}).then(e=>e.ok?e.json():e).then(e=>{})}})});
</script>
</html>